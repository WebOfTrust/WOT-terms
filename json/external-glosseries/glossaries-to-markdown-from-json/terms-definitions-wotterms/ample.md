## ample

<h4>Definition</h4><p>The minimum required number of participants in an event to have a <a href="supermajority">supermajority</a> so that one and only one agreement or consensus on an event may be reached. This is a critical part of the <a href="KAACE">KAACE</a> agreement algorithm (consensus) in KERI for establishing consensus between witnesses on the key state of a KERI identifier. This consensus on key state forms the basis for accountability for a KERI controller, or what a person who controls a KERI identifier may be held legally responsible for.</p><p>This supermajority is also called a <em>sufficient majority</em> that is labeled <em>immune</em> from certain kinds of attacks or faults. </p><p>From section <strong>11.4.2.4 Immune</strong> of v2.60 of the KERI whitepaper, </p><blockquote><p>Satisfaction of this constraint guarantees that at most one sufficient agreement occurs or none atall despite a dishonest controller but where at most F of the witnesses are potentially faulty.</p></blockquote><p>Ample Agreement Constraint:<br><img src="https://github.com/WebOfTrust/WOT-terms/assets/65027257/5c8733c1-4370-420c-83f0-f6e778a6b68f" alt="image"></p><p>Can apply to either</p><ol><li>a group of KERI witnesses for a witnessed event or </li><li>a group of KERI identifier controllers participating in a multi-signature group.</li></ol><h4>Problems avoided by using <code>ample</code></h4><p>Ample witnesses avoids problems of accidental lockout from a multisig group which would occur if the signing threshold for the multisig group was set lower than the &quot;ample&quot; number of participants.</p><h4>Table of minimum required, or ample, number of participants</h4><p>N = Number of total participants<br>M = Number of participants needed to get the guarantees of &quot;ample&quot;</p><p><img src="https://github.com/WebOfTrust/WOT-terms/assets/65027257/01363aeb-7055-4413-bbc4-8f89325e703a" alt="image"></p><h4>Code Example</h4><p>Python code implementation from <a href="https://github.com/WebOfTrust/keripy/blob/development/src/keri/core/eventing.py">keri.core.eventing.py</a> of the <code>ample</code> algorithm used in <a href="KAACE">KAACE</a>:</p><pre><code class="language-python">def ample(n, f=None, weak=True):    &quot;&quot;&quot;    Returns int as sufficient immune (ample) majority of n when n &gt;=1        otherwise returns 0    Parameters:        n is int total number of elements        f is int optional fault number        weak is Boolean            If f is not None and                weak is True then minimize m for f                weak is False then maximize m for f that satisfies n &gt;= 3*f+1            Else                weak is True then find maximum f and minimize m                weak is False then find maximum f and maximize m        n,m,f are subject to        f &gt;= 1 if n &gt; 0        n &gt;= 3*f+1        (n+f+1)/2 &lt;= m &lt;= n-f    &quot;&quot;&quot;    n = max(0, n)  # no negatives    if f is None:        f1 = max(1, max(0, n - 1) // 3)  # least floor f subject to n &gt;= 3*f+1        f2 = max(1, ceil(max(0, n - 1) / 3))  # most ceil f subject to n &gt;= 3*f+1        if weak:  # try both fs to see which one has lowest m            return min(n, ceil((n + f1 + 1) / 2), ceil((n + f2 + 1) / 2))        else:            return min(n, max(0, n - f1, ceil((n + f1 + 1) / 2)))    else:        f = max(0, f)        m1 = ceil((n + f + 1) / 2)        m2 = max(0, n - f)        if m2 &lt; m1 and n &gt; 0:            raise ValueError(&quot;Invalid f={} is too big for n={}.&quot;.format(f, n))        if weak:            return min(n, m1, m2)        else:            return min(n, max(m1, m2))</code></pre>

