"use strict";(self.webpackChunkwot_terms_docusaurus=self.webpackChunkwot_terms_docusaurus||[]).push([[80824],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>u});var n=a(67294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var l=n.createContext({}),d=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},c=function(e){var t=d(e.components);return n.createElement(l.Provider,{value:t},e.children)},p="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},g=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=d(a),g=o,u=p["".concat(l,".").concat(g)]||p[g]||h[g]||i;return a?n.createElement(u,r(r({ref:t},c),{},{components:a})):n.createElement(u,r({ref:t},c))}));function u(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=a.length,r=new Array(i);r[0]=g;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[p]="string"==typeof e?e:o,r[1]=s;for(var d=2;d<i;d++)r[d]=a[d];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}g.displayName="MDXCreateElement"},48581:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>d});var n=a(87462),o=(a(67294),a(3905));const i={},r=void 0,s={unversionedId:"carbon-copies/WebOfTrust-keria-main-docs-protocol",id:"carbon-copies/WebOfTrust-keria-main-docs-protocol",title:"WebOfTrust-keria-main-docs-protocol",description:"signify-keria-request-authentication-protocol--skrap-, level 1",source:"@site/docs/carbon-copies/WebOfTrust-keria-main-docs-protocol.md",sourceDirName:"carbon-copies",slug:"/carbon-copies/WebOfTrust-keria-main-docs-protocol",permalink:"/WOT-terms/docs/carbon-copies/WebOfTrust-keria-main-docs-protocol",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"WebOfTrust-ietf-ipex-main-draft-ssmith-ipex",permalink:"/WOT-terms/docs/carbon-copies/WebOfTrust-ietf-ipex-main-draft-ssmith-ipex"},next:{title:"Concepts",permalink:"/WOT-terms/docs/category/concepts"}},l={},d=[{value:"Signify/KERIA Request Authentication Protocol (SKRAP)",id:"signifykeria-request-authentication-protocol-skrap",level:2},{value:"KERIA Service Endpoint Interfaces",id:"keria-service-endpoint-interfaces",level:2},{value:"Agent Worker Initialization",id:"agent-worker-initialization",level:2},{value:"Step One:  Generate Client AID",id:"step-one--generate-client-aid",level:2},{value:"Step Two:  Agent Worker Creation",id:"step-two--agent-worker-creation",level:2},{value:"Step Three: Signify Client Delegation Approval",id:"step-three-signify-client-delegation-approval",level:2},{value:"Reconnecting to Existing Agent Worker",id:"reconnecting-to-existing-agent-worker",level:2},{value:"Key Generate Methods",id:"key-generate-methods",level:2},{value:"Salty Keys",id:"salty-keys",level:2},{value:"Salty Key Salt Rotations",id:"salty-key-salt-rotations",level:2},{value:"Randy Keys",id:"randy-keys",level:2},{value:"Sandy Keys",id:"sandy-keys",level:2},{value:"Group Keys",id:"group-keys",level:2},{value:"HSM Keys (Experimental)",id:"hsm-keys-experimental",level:2},{value:"Passcode Rotation",id:"passcode-rotation",level:2},{value:"Partial Client AID Rotaion in Support of Passcode Rotation",id:"partial-client-aid-rotaion-in-support-of-passcode-rotation",level:2},{value:"Passcode Rotation Recovery",id:"passcode-rotation-recovery",level:2},{value:"Signify Request/Response Authentication",id:"signify-requestresponse-authentication",level:2},{value:"Metadata Headers",id:"metadata-headers",level:2},{value:"Signature Input Header",id:"signature-input-header",level:2},{value:"Signature Header",id:"signature-header",level:2}],c={toc:d},p="wrapper";function h(e){let{components:t,...a}=e;return(0,o.kt)(p,(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("div",{className:"accordion"},(0,o.kt)("div",{className:"accordion-item accordion-item-signify-keria-request-authentication-protocol--skrap-","data-level":"1"},(0,o.kt)("h2",{className:"accordion-header",id:"headersignify-keria-request-authentication-protocol--skrap-"},(0,o.kt)("button",{className:"accordion-button",type:"button","data-bs-toggle":"collapse","data-bs-target":"#accordeon-signify-keria-request-authentication-protocol--skrap-","aria-expanded":"true","aria-controls":"accordeon-signify-keria-request-authentication-protocol--skrap-"},"signify-keria-request-authentication-protocol--skrap-, level 1")),(0,o.kt)("div",{id:"accordeon-signify-keria-request-authentication-protocol--skrap-",className:"accordion-collapse collapse","aria-labelledby":"headersignify-keria-request-authentication-protocol--skrap-"},(0,o.kt)("div",{className:"accordion-body"},(0,o.kt)("h2",{id:"signifykeria-request-authentication-protocol-skrap"},"Signify/KERIA Request Authentication Protocol (SKRAP)")))),(0,o.kt)("div",{className:"accordion-item accordion-item-keria-service-endpoint-interfaces","data-level":"1"},(0,o.kt)("h2",{className:"accordion-header",id:"headerkeria-service-endpoint-interfaces"},(0,o.kt)("button",{className:"accordion-button",type:"button","data-bs-toggle":"collapse","data-bs-target":"#accordeon-keria-service-endpoint-interfaces","aria-expanded":"true","aria-controls":"accordeon-keria-service-endpoint-interfaces"},"keria-service-endpoint-interfaces, level 1")),(0,o.kt)("div",{id:"accordeon-keria-service-endpoint-interfaces",className:"accordion-collapse collapse","aria-labelledby":"headerkeria-service-endpoint-interfaces"},(0,o.kt)("div",{className:"accordion-body"},(0,o.kt)("h2",{id:"keria-service-endpoint-interfaces"},"KERIA Service Endpoint Interfaces"),(0,o.kt)("p",null,"The KERIA service will expose 3 separate HTTP endpoints on 3 separate network interfaces."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Boot Interface - Exposes one endpoint for Agent Worker initialization."),(0,o.kt)("li",{parentName:"ol"},"Admin Interface - The REST API for command and control operations from the Signify Client."),(0,o.kt)("li",{parentName:"ol"},"KERI Protocol Interface - CESR over HTTP endpoint for KERI protocol interactions with the rest of the world.")),(0,o.kt)("p",null,"This separation allows for the Boot interface to be expose to internal infrastructure only (or disabled all together) while exposing the other two interfaces externally.  If a KERIA instance is launched in static worker mode, meaning all agent workers are configured at start up only the Boot interface can be disabled completely.")))),(0,o.kt)("div",{className:"accordion-item accordion-item-agent-worker-initialization","data-level":"1"},(0,o.kt)("h2",{className:"accordion-header",id:"headeragent-worker-initialization"},(0,o.kt)("button",{className:"accordion-button",type:"button","data-bs-toggle":"collapse","data-bs-target":"#accordeon-agent-worker-initialization","aria-expanded":"true","aria-controls":"accordeon-agent-worker-initialization"},"agent-worker-initialization, level 1")),(0,o.kt)("div",{id:"accordeon-agent-worker-initialization",className:"accordion-collapse collapse","aria-labelledby":"headeragent-worker-initialization"},(0,o.kt)("div",{className:"accordion-body"},(0,o.kt)("h2",{id:"agent-worker-initialization"},"Agent Worker Initialization"),(0,o.kt)("p",null,'To initiate a connection between a Signify Client and a KERIA agent, the two sides will exchange KERI AIDs with the Signify Client AID (called the "Client AID") being the delegator for the KERIA agent worker AID (called the "Agent AID").  To establish the connection the following steps are performed:')))),(0,o.kt)("div",{className:"accordion-item accordion-item-step-one---generate-client-aid","data-level":"1"},(0,o.kt)("h2",{className:"accordion-header",id:"headerstep-one---generate-client-aid"},(0,o.kt)("button",{className:"accordion-button",type:"button","data-bs-toggle":"collapse","data-bs-target":"#accordeon-step-one---generate-client-aid","aria-expanded":"true","aria-controls":"accordeon-step-one---generate-client-aid"},"step-one---generate-client-aid, level 1")),(0,o.kt)("div",{id:"accordeon-step-one---generate-client-aid",className:"accordion-collapse collapse","aria-labelledby":"headerstep-one---generate-client-aid"},(0,o.kt)("div",{className:"accordion-body"},(0,o.kt)("h2",{id:"step-one--generate-client-aid"},"Step One:  Generate Client AID"),(0,o.kt)("p",null,"The Signify Client generates the client AID as a transferable AID with a single signing key and single rotation key and provides the signed inception event out-of-bands to the KERIA service through the Boot interface. The HTTP request must be signed by the client AID using Signify Request Authentication described below.  The algorithm for generating the signing and rotation key pairs for Client AID is as follows:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Prepend the 128 bit random salt derivation code ('0A') plus the blank qualified base 64 character ('A') to the provided 21 character passcode"),(0,o.kt)("li",{parentName:"ol"},'Stretch the passcode derivation using Argon2 to generate an Ed25519 private key from the provided "tier" and paths of ',(0,o.kt)("inlineCode",{parentName:"li"},"signify:controller00")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"signify:controller01")," for the signing key and rotation key respectively."),(0,o.kt)("li",{parentName:"ol"},"Use the qualified base64 of the signing public key and the qualified base64 of the Blake3 digest of the rotation public key in the inception event.")),(0,o.kt)("p",null,"The follow is an example of a Client AID generated by the SignifyPy (Python implementation) Signify Client with a passcode of ",(0,o.kt)("inlineCode",{parentName:"p"},"0123456789abcdefghijk")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n "v": "KERI10JSON00012b_",\n "t": "icp",\n "d": "ELI7pg979AdhmvrjDeam2eAO2SR5niCgnjAJXJHtJose",\n "i": "ELI7pg979AdhmvrjDeam2eAO2SR5niCgnjAJXJHtJose",  // Client AID\n "s": "0",\n "kt": "1",\n "k": [\n  "DAbWjobbaLqRB94KiAutAHb_qzPpOHm3LURA_ksxetVc"  // Derived from passcode as salt, kidx = 0\n ],\n "nt": "1",\n "n": [\n  "EIFG_uqfr1yN560LoHYHfvPAhxQ5sN6xZZT_E3h7d2tL"  // Derived from passcode as salt, kidx = 1, Blake3 Hashed\n ],\n "bt": "0",\n "b": [],\n "c": [],\n "a": []\n}\n'))))),(0,o.kt)("div",{className:"accordion-item accordion-item-step-two---agent-worker-creation","data-level":"1"},(0,o.kt)("h2",{className:"accordion-header",id:"headerstep-two---agent-worker-creation"},(0,o.kt)("button",{className:"accordion-button",type:"button","data-bs-toggle":"collapse","data-bs-target":"#accordeon-step-two---agent-worker-creation","aria-expanded":"true","aria-controls":"accordeon-step-two---agent-worker-creation"},"step-two---agent-worker-creation, level 1")),(0,o.kt)("div",{id:"accordeon-step-two---agent-worker-creation",className:"accordion-collapse collapse","aria-labelledby":"headerstep-two---agent-worker-creation"},(0,o.kt)("div",{className:"accordion-body"},(0,o.kt)("h2",{id:"step-two--agent-worker-creation"},"Step Two:  Agent Worker Creation"),(0,o.kt)("p",null,"The KERIA service will create an Agent Worker on behalf of the new client and create the delegated, transferable Agent AID\nwith a single signing key and single rotation key specifying the Client AID as its delegator in its inception event.",(0,o.kt)("br",{parentName:"p"}),"\n","The KERIA service will return the Agent AID inception event in a signed HTTP response, signed by the Agent AID.  Agent AID keys\ncan be generated using a salt or truly random depending on the requirements of the service hosting the KERIA service."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n "v": "KERI10JSON00015f_",\n "t": "dip",  // Delegated AID\n "d": "EEXekkGu9IAzav6pZVJhkLnjtjM5v3AcyA-pdKUcaGei",\n "i": "EEXekkGu9IAzav6pZVJhkLnjtjM5v3AcyA-pdKUcaGei",  // Agent AID\n "s": "0",\n "kt": "1",\n "k": [\n  "DMZh_y-H5C3cSbZZST-fqnsmdNTReZxIh0t2xSTOJQ8a"\n ],\n "nt": "1",\n "n": [\n  "EM9M2EQNCBK0MyAhVYBvR98Q0tefpvHgE-lHLs82XgqC"\n ],\n "bt": "0",\n "b": [],\n "c": [],\n "a": [],\n "di": "ELI7pg979AdhmvrjDeam2eAO2SR5niCgnjAJXJHtJose"  // Delegated signing authority from Client AID\n}\n'))))),(0,o.kt)("div",{className:"accordion-item accordion-item-step-three--signify-client-delegation-approval","data-level":"1"},(0,o.kt)("h2",{className:"accordion-header",id:"headerstep-three--signify-client-delegation-approval"},(0,o.kt)("button",{className:"accordion-button",type:"button","data-bs-toggle":"collapse","data-bs-target":"#accordeon-step-three--signify-client-delegation-approval","aria-expanded":"true","aria-controls":"accordeon-step-three--signify-client-delegation-approval"},"step-three--signify-client-delegation-approval, level 1")),(0,o.kt)("div",{id:"accordeon-step-three--signify-client-delegation-approval",className:"accordion-collapse collapse","aria-labelledby":"headerstep-three--signify-client-delegation-approval"},(0,o.kt)("div",{className:"accordion-body"},(0,o.kt)("h2",{id:"step-three-signify-client-delegation-approval"},"Step Three: Signify Client Delegation Approval"),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"Note that all HTTP requests against the Admin Interface must be signed by the Client AID and expect all responses to be signed by the Agent AID.")),(0,o.kt)("p",null,"The Signify Client will approve the delegation of the client AID with an interaction event that it sends back to the KERIA service over the Admin interface."),(0,o.kt)("p",null,"Once these steps are complete the Signify Client can begin using the rest of the Admin interface to create AIDs, issue credentials, etc.")))),(0,o.kt)("div",{className:"accordion-item accordion-item-reconnecting-to-existing-agent-worker","data-level":"1"},(0,o.kt)("h2",{className:"accordion-header",id:"headerreconnecting-to-existing-agent-worker"},(0,o.kt)("button",{className:"accordion-button",type:"button","data-bs-toggle":"collapse","data-bs-target":"#accordeon-reconnecting-to-existing-agent-worker","aria-expanded":"true","aria-controls":"accordeon-reconnecting-to-existing-agent-worker"},"reconnecting-to-existing-agent-worker, level 1")),(0,o.kt)("div",{id:"accordeon-reconnecting-to-existing-agent-worker",className:"accordion-collapse collapse","aria-labelledby":"headerreconnecting-to-existing-agent-worker"},(0,o.kt)("div",{className:"accordion-body"},(0,o.kt)("h2",{id:"reconnecting-to-existing-agent-worker"},"Reconnecting to Existing Agent Worker"),(0,o.kt)("p",null,"Document the steps for retrieving state from the Admin interface and updating.")))),(0,o.kt)("div",{className:"accordion-item accordion-item-key-generate-methods","data-level":"1"},(0,o.kt)("h2",{className:"accordion-header",id:"headerkey-generate-methods"},(0,o.kt)("button",{className:"accordion-button",type:"button","data-bs-toggle":"collapse","data-bs-target":"#accordeon-key-generate-methods","aria-expanded":"true","aria-controls":"accordeon-key-generate-methods"},"key-generate-methods, level 1")),(0,o.kt)("div",{id:"accordeon-key-generate-methods",className:"accordion-collapse collapse","aria-labelledby":"headerkey-generate-methods"},(0,o.kt)("div",{className:"accordion-body"},(0,o.kt)("h2",{id:"key-generate-methods"},"Key Generate Methods"),(0,o.kt)("p",null,"The KERIA service supports the following key generation methods where the Signify Client generates the keys and only ever sends encrypted key material (if any) to the server."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Salty Keys - HDK key chain generated from a salt per aid that is encrypted and stored server."),(0,o.kt)("li",{parentName:"ol"},"Randy Keys - Randomly generated keys (signing and rotation) that are encrypted and store on the server."),(0,o.kt)("li",{parentName:"ol"},"Sandy Keys - Keys generated from a different salt for inception and each rotation.  "),(0,o.kt)("li",{parentName:"ol"},"Group Keys - Signify Client/KERIA Service AIDs participating in a distributed group multisig AID."),(0,o.kt)("li",{parentName:"ol"},"HSM Keys - Signify Client uses a Signify HSM Integration Module (SHIM) to manage keys and signatures.")),(0,o.kt)("p",null,"For all key generation methods, the Signify Client creates and signs all KERI events, credentials, etc. ensuring that unencrypted private key material never leaves the client. The key generate methods are descrive in more detail in the following sections.")))),(0,o.kt)("div",{className:"accordion-item accordion-item-salty-keys","data-level":"1"},(0,o.kt)("h2",{className:"accordion-header",id:"headersalty-keys"},(0,o.kt)("button",{className:"accordion-button",type:"button","data-bs-toggle":"collapse","data-bs-target":"#accordeon-salty-keys","aria-expanded":"true","aria-controls":"accordeon-salty-keys"},"salty-keys, level 1")),(0,o.kt)("div",{id:"accordeon-salty-keys",className:"accordion-collapse collapse","aria-labelledby":"headersalty-keys"},(0,o.kt)("div",{className:"accordion-body"},(0,o.kt)("h2",{id:"salty-keys"},"Salty Keys"),(0,o.kt)("p",null,"The Salty Key algorithm is used to create a hierarchical deterministic key chain for each AID by generating a unique random salt for each AID and stretching the salt using Argon2 with a ",(0,o.kt)("inlineCode",{parentName:"p"},"path")," that is calculated from the AIDs index relative to all other AIDs and the key index calculated by the total number of signing and rotation keys over the lifetime of the AID."),(0,o.kt)("p",null,"The salt for each AID is encrypted with the X25519 encryption key generated from the passcode and stored on the server with other AID metadata, including the AID index and current key index.  "),(0,o.kt)("p",null,"The Signify Client API must accept the AID salt as an optional parameter to creating Salty Key AIDs allowing users to manage AID salts externally or to share Salts across AIDs if required."),(0,o.kt)("p",null,"The following Python data class represents the metadata storage for Salty Key AIDs:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"class SaltyPrm:\n    \"\"\"\n    Salty prefix's parameters for creating new key pairs\n    \"\"\"\n    sxlt: str = ''  # qualified b64 encoded AID salt\n    pidx: int = 0  # prefix index for this keypair sequence\n    kidx: int = 0  # key index for this keypair sequence\n    stem: str = ''  # default unique path stem for salty algo\n    tier: str = ''  # security tier for stretch index salty algo\n    dcode: str = ''  # next digest hasing code\n    icodes: list = field(default_factory=list)  # current signing key seed codes\n    ncodes: list = field(default_factory=list)  # next key seed codes\n    transferable: bool = False\n\n"))))),(0,o.kt)("div",{className:"accordion-item accordion-item-salty-key-salt-rotations","data-level":"1"},(0,o.kt)("h2",{className:"accordion-header",id:"headersalty-key-salt-rotations"},(0,o.kt)("button",{className:"accordion-button",type:"button","data-bs-toggle":"collapse","data-bs-target":"#accordeon-salty-key-salt-rotations","aria-expanded":"true","aria-controls":"accordeon-salty-key-salt-rotations"},"salty-key-salt-rotations, level 1")),(0,o.kt)("div",{id:"accordeon-salty-key-salt-rotations",className:"accordion-collapse collapse","aria-labelledby":"headersalty-key-salt-rotations"},(0,o.kt)("div",{className:"accordion-body"},(0,o.kt)("h2",{id:"salty-key-salt-rotations"},"Salty Key Salt Rotations"),(0,o.kt)("p",null,"Document the procedure for rotating a new Salt in for a Salty Key AID.")))),(0,o.kt)("div",{className:"accordion-item accordion-item-randy-keys","data-level":"1"},(0,o.kt)("h2",{className:"accordion-header",id:"headerrandy-keys"},(0,o.kt)("button",{className:"accordion-button",type:"button","data-bs-toggle":"collapse","data-bs-target":"#accordeon-randy-keys","aria-expanded":"true","aria-controls":"accordeon-randy-keys"},"randy-keys, level 1")),(0,o.kt)("div",{id:"accordeon-randy-keys",className:"accordion-collapse collapse","aria-labelledby":"headerrandy-keys"},(0,o.kt)("div",{className:"accordion-body"},(0,o.kt)("h2",{id:"randy-keys"},"Randy Keys"),(0,o.kt)("p",null,"The Randy Key algorithm allows for all signing and rotation private keys to be generated solely from entropy and encrypted with the X25519 encryption key generated from the passcode and stored on the server alongside other AID metadata."),(0,o.kt)("p",null,"The server stores the encrypted private key material for signing and rotation keys in separate LMBD sub-databases as indexed qualified base 64 CESR encoded Cipher representations. ")))),(0,o.kt)("div",{className:"accordion-item accordion-item-sandy-keys","data-level":"1"},(0,o.kt)("h2",{className:"accordion-header",id:"headersandy-keys"},(0,o.kt)("button",{className:"accordion-button",type:"button","data-bs-toggle":"collapse","data-bs-target":"#accordeon-sandy-keys","aria-expanded":"true","aria-controls":"accordeon-sandy-keys"},"sandy-keys, level 1")),(0,o.kt)("div",{id:"accordeon-sandy-keys",className:"accordion-collapse collapse","aria-labelledby":"headersandy-keys"},(0,o.kt)("div",{className:"accordion-body"},(0,o.kt)("h2",{id:"sandy-keys"},"Sandy Keys")))),(0,o.kt)("div",{className:"accordion-item accordion-item-group-keys","data-level":"1"},(0,o.kt)("h2",{className:"accordion-header",id:"headergroup-keys"},(0,o.kt)("button",{className:"accordion-button",type:"button","data-bs-toggle":"collapse","data-bs-target":"#accordeon-group-keys","aria-expanded":"true","aria-controls":"accordeon-group-keys"},"group-keys, level 1")),(0,o.kt)("div",{id:"accordeon-group-keys",className:"accordion-collapse collapse","aria-labelledby":"headergroup-keys"},(0,o.kt)("div",{className:"accordion-body"},(0,o.kt)("h2",{id:"group-keys"},"Group Keys"),(0,o.kt)("p",null,'The Group Key algorithm is a special key generation algorith for distributed group multisig AIDs that does not manage and keys at all.  Instead this algoritm allows for the specification of an AID of one of the other three types to be the "local" participant in a distributed group multisig AID.  '),(0,o.kt)("p",null,'All signing operations must be performed on the Signify Client on behalf of the "local" AID for this Signify Client indexed based on the local AID\'s location in both the signing key list and the rotation key list.  ')))),(0,o.kt)("div",{className:"accordion-item accordion-item-hsm-keys--experimental-","data-level":"1"},(0,o.kt)("h2",{className:"accordion-header",id:"headerhsm-keys--experimental-"},(0,o.kt)("button",{className:"accordion-button",type:"button","data-bs-toggle":"collapse","data-bs-target":"#accordeon-hsm-keys--experimental-","aria-expanded":"true","aria-controls":"accordeon-hsm-keys--experimental-"},"hsm-keys--experimental-, level 1")),(0,o.kt)("div",{id:"accordeon-hsm-keys--experimental-",className:"accordion-collapse collapse","aria-labelledby":"headerhsm-keys--experimental-"},(0,o.kt)("div",{className:"accordion-body"},(0,o.kt)("h2",{id:"hsm-keys-experimental"},"HSM Keys (Experimental)"),(0,o.kt)("p",null,"The SignifyPy Signify Client defines an experimental interface for declaring external modules that can be used as Signify HSM Integration Modules to allow all key generation and event signing to occur in an external Hardware Security Module (HSM).  "),(0,o.kt)("p",null,"Two sample implementations have been defined to date, one using the Google KSM and one using a Trezure One external HSM."),(0,o.kt)("p",null,"The following psuedo Python class represents the current, experimental interface a SHIM has to implememnt to work with SignifyPy.  It is anticipated that each Signify Client implementation defines a similar interface."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'class Shim:\n    def incept(self, transferable=True):\n        """  Create an AID using the Google KSM for key generation and event signing.\n\n        Parameters:\n            transferable (bool):  True means create a transferable AID which allows for key rotation\n\n        Returns:\n            keys (list): list of qualified base64 public signing key deriviations based on the codes passed into init\n            ndigs (list): list of qualified base64 digests of public rotation key derivations based on the codes\n                          passed into init\n\n        """\n\n    def rotate(self, ncount, transferable):\n        """  Rotate an AID using the Google KSM for key generation and event signing.\n\n        Parameters:\n            ncount (int): number of new rotation keys to generate\n            transferable (bool):  True means create a transferable AID which allows for key rotation\n\n        Returns:\n            keys (list): list of qualified base64 public signing key deriviations based on the codes passed into init\n            ndigs (list): list of qualified base64 digests of public rotation key derivations based on the codes\n                          passed into init\n\n        """\n        \n    def sign(self, ser, indexed=True, indices=None, ondices=None, **_):\n        """\n\n        Parameters:\n            ser (bytes): content to be signed\n            indexed (bool): True means generated indexed signatures\n            indices (list): Optional list of indices to use when generating indexed signatures\n            ondices (list): Optional list of rotation indices to use when generating dual indexed signatures\n            **_: Placeholder\n\n        Returns:\n            sigs (list): list of qualified base64 signatures over the based in ser\n        """\n\n'))))),(0,o.kt)("div",{className:"accordion-item accordion-item-passcode-rotation","data-level":"1"},(0,o.kt)("h2",{className:"accordion-header",id:"headerpasscode-rotation"},(0,o.kt)("button",{className:"accordion-button",type:"button","data-bs-toggle":"collapse","data-bs-target":"#accordeon-passcode-rotation","aria-expanded":"true","aria-controls":"accordeon-passcode-rotation"},"passcode-rotation, level 1")),(0,o.kt)("div",{id:"accordeon-passcode-rotation",className:"accordion-collapse collapse","aria-labelledby":"headerpasscode-rotation"},(0,o.kt)("div",{className:"accordion-body"},(0,o.kt)("h2",{id:"passcode-rotation"},"Passcode Rotation"),(0,o.kt)("p",null,"To perform a passcode rotation, the Signify Client requires both old and new passcodes and must perform the following steps:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Encrypted the old passcode with X25519 key generated from the new passcode."),(0,o.kt)("li",{parentName:"ol"},"Perform a partial rotation of the Client AID as described below."),(0,o.kt)("li",{parentName:"ol"},"Decrypt all salts with X25519 key from old passcode for Salty Keys, validate them against current public keys, encrypt with X25519 key from new passcode"),(0,o.kt)("li",{parentName:"ol"},"Decrypt all keys with X25519 key from old passcode for Randy Keys, validate them against current public keys, encrypt with X25519 key from new passcode"),(0,o.kt)("li",{parentName:"ol"},"Send all rotation event and all recrypted material in a POST request to the agent on ",(0,o.kt)("inlineCode",{parentName:"li"},"/agent/<Client AID>")))))),(0,o.kt)("div",{className:"accordion-item accordion-item-partial-client-aid-rotaion-in-support-of-passcode-rotation","data-level":"1"},(0,o.kt)("h2",{className:"accordion-header",id:"headerpartial-client-aid-rotaion-in-support-of-passcode-rotation"},(0,o.kt)("button",{className:"accordion-button",type:"button","data-bs-toggle":"collapse","data-bs-target":"#accordeon-partial-client-aid-rotaion-in-support-of-passcode-rotation","aria-expanded":"true","aria-controls":"accordeon-partial-client-aid-rotaion-in-support-of-passcode-rotation"},"partial-client-aid-rotaion-in-support-of-passcode-rotation, level 1")),(0,o.kt)("div",{id:"accordeon-partial-client-aid-rotaion-in-support-of-passcode-rotation",className:"accordion-collapse collapse","aria-labelledby":"headerpartial-client-aid-rotaion-in-support-of-passcode-rotation"},(0,o.kt)("div",{className:"accordion-body"},(0,o.kt)("h2",{id:"partial-client-aid-rotaion-in-support-of-passcode-rotation"},"Partial Client AID Rotaion in Support of Passcode Rotation"),(0,o.kt)("p",null,"To provide post-quantum secure passcode recovery, a passcode recovery must be accompanied by partial rotation of the Client AID. This partial rotation is possible because the user will have to provide both old and new passcodes to initiate the process."),(0,o.kt)("p",null,"The partial rotation of the Client AID is accomplished by using the old passcode to regenerate the the prior rotation key pair called ",(0,o.kt)("inlineCode",{parentName:"p"},"R0")," from the latest establishment event.  In addition, two new key pairs are generated from the new passocde, one used for signing authority (S0) and one used for rotation authority (R1) in the new rotation event."),(0,o.kt)("p",null,"The public key for ",(0,o.kt)("inlineCode",{parentName:"p"},"S0"),' is used as the first signing key in the new rotation event; it is giving a fractionally weighted threshold of "1".  The public key for ',(0,o.kt)("inlineCode",{parentName:"p"},"R0"),' is used as the second signing key in the new rotation event; it is giving a fractionally weighted threshold of "0".  A Blake3 has is created of the public key for ',(0,o.kt)("inlineCode",{parentName:"p"},"R1")," and is used as the next rotation key commitment."),(0,o.kt)("p",null,"The rotation event is signed with the private keys of both ",(0,o.kt)("inlineCode",{parentName:"p"},"S0")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"R0"),".  An example of a partial rotation event of the Client AID from above follows with its signatures:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n "v": "KERI10JSON000195_",\n "t": "rot",\n "d": "EGTAY6x1tTbOO27LCy3poh5iW0Oa2Cq1s7wsVnj152Zi",\n "i": "ELI7pg979AdhmvrjDeam2eAO2SR5niCgnjAJXJHtJose",\n "s": "1",\n "p": "ELI7pg979AdhmvrjDeam2eAO2SR5niCgnjAJXJHtJose",\n "kt": [\n  "1",  // Threshold for key derived from NEW passcode, has full signing authority\n  "0"   // Threshold for key derived from OLD passcode, no signing authority\n ],\n "k": [\n  "DAbWjobbaLqRB94KiAutAHb_qzPpOHm3LURA_ksxetVc",  // Derived from NEW passcode as salt, kidx = 0 \n  "DHMAZEksiqGxlNKnm0pSAyMRPK1ZKyBfGV8q_B9r6pLs"   // Derived from OLD passcode as salt, kidx = 1 (matches previous rotation key)\n ],\n "nt": "1",\n "n": [\n  "EIFG_uqfr1yN560LoHYHfvPAhxQ5sN6xZZT_E3h7d2tL"   // Derived from NEW passcode as salt, kidx = 1, Blake3 Hashed\n ],\n "bt": "0",\n "br": [],\n "ba": [],\n "a": []\n}\n')),(0,o.kt)("p",null,"With the following attached signatures:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'[\n  "AADuzJ4zU8MkLBPP8Os9UPbTvNqoQ4YDImNkTjfknWgJW25V6EmwZ59PXas0zKhxtp_dOhvkPqtqIhgarOFwt7sC",\n  "2AABAACRZGDB7s4hmYnt7vTYGWCawhnqHndWUy_rtR_L8mfNmrJ4N5S05wAZ6w5RoL68h1HjIzO7ZuiF30XBz1cC6eUA"\n]\n')),(0,o.kt)("p",null,"The first signature satisfies the current signing threshold and has only one index, 0 for signing key index.  The second signature satifies the prior rotation threshold and thus uses dual index code to specify a current signing index of 1 and a prior signing index of 0."),(0,o.kt)("p",null,"The following steps are followed to accept the passcode rotation:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Verify and accept the Client AID rotation"),(0,o.kt)("li",{parentName:"ol"},"Verify the signature on the request against the NEW signing key of the Client AID"),(0,o.kt)("li",{parentName:"ol"},"Save encrypted old passcode"),(0,o.kt)("li",{parentName:"ol"},"Update all Salty Key encrypted salts"),(0,o.kt)("li",{parentName:"ol"},"Update all Randy Key encrypted keys"),(0,o.kt)("li",{parentName:"ol"},"Delete encrypted old passcode"))))),(0,o.kt)("div",{className:"accordion-item accordion-item-passcode-rotation-recovery","data-level":"1"},(0,o.kt)("h2",{className:"accordion-header",id:"headerpasscode-rotation-recovery"},(0,o.kt)("button",{className:"accordion-button",type:"button","data-bs-toggle":"collapse","data-bs-target":"#accordeon-passcode-rotation-recovery","aria-expanded":"true","aria-controls":"accordeon-passcode-rotation-recovery"},"passcode-rotation-recovery, level 1")),(0,o.kt)("div",{id:"accordeon-passcode-rotation-recovery",className:"accordion-collapse collapse","aria-labelledby":"headerpasscode-rotation-recovery"},(0,o.kt)("div",{className:"accordion-body"},(0,o.kt)("h2",{id:"passcode-rotation-recovery"},"Passcode Rotation Recovery"),(0,o.kt)("p",null,"When each Agent Worker is loaded it will check for a saved old passcode to detect an aborted passcode rotation.  If a saved encrypted old passcode is found the Agent Worker will\nnotify the client in the response to the state call that a passcode rotation recovery is needed and lock out all other operations until it is completed successfully."),(0,o.kt)("p",null,"To perform a passcode rotation recovery, the Signify Client requires only the new passcode and must perform the following steps:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Retrieve the encrypted old passcode and decrypt it with X25519 key generated from the new passcode."),(0,o.kt)("li",{parentName:"ol"},"Perform a revised partial rotation of the Client AID where you rotate out to a new next key not new signing key."),(0,o.kt)("li",{parentName:"ol"},"Attempt to decrypt all salts with the X25519 keys from both the old and new passcode for Salty Keys"),(0,o.kt)("li",{parentName:"ol"},"For any salt still encrypted with the old passcode, encrypt with X25519 key from new passcode "),(0,o.kt)("li",{parentName:"ol"},"Attempt to decrypt all keys with the X25519 keys from both the old and new passcode for Randy Keys"),(0,o.kt)("li",{parentName:"ol"},"Validate them against current public keys and for any key still encrypted with the old passcode, encrypt with X25519 key from new passcode"),(0,o.kt)("li",{parentName:"ol"},"Send all rotation event and all recrypted material in a POST request to the agent on ",(0,o.kt)("inlineCode",{parentName:"li"},"/agent/<Client AID>")))))),(0,o.kt)("div",{className:"accordion-item accordion-item-signify-request-response-authentication","data-level":"1"},(0,o.kt)("h2",{className:"accordion-header",id:"headersignify-request-response-authentication"},(0,o.kt)("button",{className:"accordion-button",type:"button","data-bs-toggle":"collapse","data-bs-target":"#accordeon-signify-request-response-authentication","aria-expanded":"true","aria-controls":"accordeon-signify-request-response-authentication"},"signify-request-response-authentication, level 1")),(0,o.kt)("div",{id:"accordeon-signify-request-response-authentication",className:"accordion-collapse collapse","aria-labelledby":"headersignify-request-response-authentication"},(0,o.kt)("div",{className:"accordion-body"},(0,o.kt)("h2",{id:"signify-requestresponse-authentication"},"Signify Request/Response Authentication"),(0,o.kt)("p",null,"Signify clients must sign all requests to the KERIA Admin Interface using the latest signing key of the Client AID and must expect all responses from the KERIA service be signed by the latest signing key of the Agent AID.  Both request and response signing rely on the same set of HTTP headers to accomplish request/response signing.")))),(0,o.kt)("div",{className:"accordion-item accordion-item-metadata-headers","data-level":"1"},(0,o.kt)("h2",{className:"accordion-header",id:"headermetadata-headers"},(0,o.kt)("button",{className:"accordion-button",type:"button","data-bs-toggle":"collapse","data-bs-target":"#accordeon-metadata-headers","aria-expanded":"true","aria-controls":"accordeon-metadata-headers"},"metadata-headers, level 1")),(0,o.kt)("div",{id:"accordeon-metadata-headers",className:"accordion-collapse collapse","aria-labelledby":"headermetadata-headers"},(0,o.kt)("div",{className:"accordion-body"},(0,o.kt)("h2",{id:"metadata-headers"},"Metadata Headers"),(0,o.kt)("p",null,"Document ",(0,o.kt)("inlineCode",{parentName:"p"},"Signify-Resource")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Signify-Timestamp")," headers here.")))),(0,o.kt)("div",{className:"accordion-item accordion-item-signature-input-header","data-level":"1"},(0,o.kt)("h2",{className:"accordion-header",id:"headersignature-input-header"},(0,o.kt)("button",{className:"accordion-button",type:"button","data-bs-toggle":"collapse","data-bs-target":"#accordeon-signature-input-header","aria-expanded":"true","aria-controls":"accordeon-signature-input-header"},"signature-input-header, level 1")),(0,o.kt)("div",{id:"accordeon-signature-input-header",className:"accordion-collapse collapse","aria-labelledby":"headersignature-input-header"},(0,o.kt)("div",{className:"accordion-body"},(0,o.kt)("h2",{id:"signature-input-header"},"Signature Input Header"),(0,o.kt)("p",null,"Document the ",(0,o.kt)("inlineCode",{parentName:"p"},"Signagture-Input")," header here with link to ",(0,o.kt)("a",{parentName:"p",href:"https://httpwg.org/http-extensions/draft-ietf-httpbis-message-signatures.html"},"https://httpwg.org/http-extensions/draft-ietf-httpbis-message-signatures.html"))))),(0,o.kt)("div",{className:"accordion-item accordion-item-signature-header","data-level":"1"},(0,o.kt)("h2",{className:"accordion-header",id:"headersignature-header"},(0,o.kt)("button",{className:"accordion-button",type:"button","data-bs-toggle":"collapse","data-bs-target":"#accordeon-signature-header","aria-expanded":"true","aria-controls":"accordeon-signature-header"},"signature-header, level 1")),(0,o.kt)("div",{id:"accordeon-signature-header",className:"accordion-collapse collapse","aria-labelledby":"headersignature-header"},(0,o.kt)("div",{className:"accordion-body"},(0,o.kt)("h2",{id:"signature-header"},"Signature Header"),(0,o.kt)("p",null,"Docuemnt the signing method and ",(0,o.kt)("inlineCode",{parentName:"p"},"Signature")," header."))))))}h.isMDXComponent=!0}}]);